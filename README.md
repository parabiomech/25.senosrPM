# 휠체어 모빌리티 분석기 (Wheelchair Mobility Analyzer)

휴대폰 센서 데이터를 활용한 휠체어 모빌리티 성능 분석 도구입니다.

## 📋 주요 기능

### ✨ 최신 업데이트
- **올바른 좌표계**: 빨간색=Z축, 녹색=Y축, 파란색=X축
- **휠체어 방향**: 녹색 Y축 방향을 향하도록 90도 회전
- **XY 평면 그리드**: 바닥이 XY 평면에 표시
- **직관적인 마우스 조작**:
  - 왼쪽 드래그: 시점 이동 (PAN)
  - 마우스 휠: 확대/축소 (ZOOM)
  - 오른쪽 드래그: 회전 (ROTATE)
- **그래프 재생 시점 표시**: 주황색 점선으로 현재 재생 위치 표시
- **구간별 그래프**: 테스트 모드 선택 시 해당 구간만 그래프에 표시
- **구간별 재생**: 테스트 모드 선택 시 해당 구간만 자동으로 활성화
- **시간 동기화**: 3D 시각화, 그래프, 재생 컨트롤이 모두 싱크됨
- **중앙 시작**: 각 테스트 모드마다 휠체어가 중앙(0,0,0)에서 시작

### 3가지 모빌리티 테스트 분석

1. **원스트로크 푸시 모드** (이벤트 1-2)
   - Accelerometer Y축 분석 (앞: +, 뒤: -)
   - Butterworth Low-pass 필터 적용
   - 최대/최소 가속도 측정
   - Gyroscope Z축으로 방향 편향 평가 (좌: +, 우: -)

2. **회전 모드** (이벤트 3-4)
   - Gyroscope Z축 분석
   - 좌측/우측 회전 각속도 측정
   - 회전 균형 평가

3. **휠리 모드** (이벤트 5-6)
   - Gyroscope X축 분석 (위: +, 아래: -)
   - 앞바퀴 들기/내리기 피크 감지
   - 피크 간 시간 측정
   - 유지 구간 CV(변동계수) 계산

## 🚀 사용 방법

### 1. 데이터 수집
1. SensorLogger 앱 실행
2. 녹음 시작
3. 휠체어에 휴대폰 고정 (화면이 위를 향하도록)
4. 3가지 모빌리티 테스트 수행:
   - 각 테스트 시작 시 "My Annotation 1" 버튼 클릭
   - 각 테스트 종료 시 "My Annotation 2" 버튼 클릭
   - 총 6개의 annotation 이벤트 생성

### 2. 데이터 분석
1. 수집된 CSV 파일들을 선택 (다중 선택 가능):
   - Accelerometer.csv
   - Gyroscope.csv
   - Orientation.csv
   - Annotation.csv
   - Metadata.csv

2. 파일 업로드 후 자동으로 분석 시작

3. 테스트 모드 선택:
   - ➡️ 직진 푸시 (이벤트 1-2 구간)
   - 🔄 회전 (이벤트 3-4 구간)
   - ⚖️ 휠리 (이벤트 5-6 구간)

### 3. 3D 시각화 조작
- **시점 이동**: 왼쪽 마우스 버튼 + 드래그
- **확대/축소**: 마우스 휠 스크롤
- **회전**: 오른쪽 마우스 버튼 + 드래그
- **시점 변경**: 상단 버튼 (위, 옆, 앞, 리셋)

### 4. 재생 컨트롤
- **재생**: 선택한 테스트 구간만 재생
- **속도 조절**: 0.1x ~ 3.0x
- **진행 바**: 구간 내에서만 이동 가능

### 5. 그래프 확인
- **구간 필터링**: 선택한 테스트 모드의 구간만 표시
- **재생 위치 표시**: 주황색 점선으로 현재 위치 표시
- **탭 전환**: 가속도, 각속도, 오리엔테이션
- **실시간 동기화**: 재생 위치와 그래프 연동

## 📊 필요한 파일

- **Accelerometer.csv**: 가속도 센서 데이터
- **Gyroscope.csv**: 자이로스코프 센서 데이터
- **Orientation.csv**: 방향 센서 데이터
- **Annotation.csv**: 이벤트 마커 (6개 필요)
- **Metadata.csv**: 측정 정보

## 🎯 분석 결과

각 테스트 모드별로 다음 정보를 제공합니다:

- 분석 구간 (시작-종료 시간)
- 주요 성능 지표
- 측정 정보 (기기, 플랫폼, 측정 시간)

## 🎨 3D 좌표계

### 공간 축 (Three.js)
- **빨간색 축 (Z)**: 센서 X축 매핑
- **녹색 축 (Y)**: 센서 Y축 매핑 (휠체어가 이 방향을 향함)
- **파란색 축 (X)**: 센서 Z축 매핑

### 센서 데이터 매핑
- 센서 X → 공간 Z (빨간색)
- 센서 Y → 공간 Y (녹색)
- 센서 Z → 공간 X (파란색)

### 그리드 및 평면
- **바닥 그리드**: XY 평면 (수평)
- **Z축**: 좌우 방향 (빨간색)

### 휠체어 방향
- 녹색 Y축 방향을 향함 (90도 회전)
- 전진 시 Y축 방향으로 이동

## 🖱️ 마우스 조작

### 3D 뷰
- **왼쪽 버튼 + 드래그**: 시점 이동 (PAN)
- **마우스 휠**: 확대/축소 (ZOOM)
- **오른쪽 버튼 + 드래그**: 카메라 회전 (ROTATE)

### 그래프
- **주황색 점선**: 현재 재생 위치
- **자동 업데이트**: 재생 중 실시간 이동

## 🛠 기술 스택

- HTML5 / CSS3 / JavaScript
- Three.js (3D 시각화 + OrbitControls)
- Chart.js (데이터 그래프)
- Chart.js Annotation Plugin (재생 위치 표시)
- PapaParse (CSV 파싱)
- Butterworth 필터 (신호 처리)

## 📝 주의사항

- Annotation 이벤트는 정확히 6개가 필요합니다 (각 테스트당 시작/종료 2개씩)
- 파일 업로드 시 여러 CSV 파일을 한 번에 선택할 수 있습니다
- 테스트 모드 변경 시 자동으로 해당 구간으로 이동합니다
- 각 테스트는 중앙에서 시작하여 상대적 움직임을 표시합니다
- 그래프는 선택된 테스트 구간만 표시됩니다
- **브라우저 새로고침 필요**: 코드 변경 후 Ctrl+F5로 새로고침하세요

## 🎮 단축키 및 팁

- 3D 뷰에서 더블클릭: 해당 지점으로 카메라 이동
- 재생 중 모드 변경: 자동으로 일시정지 후 새 구간으로 이동
- 리셋 버튼: 현재 테스트 구간의 시작점으로 이동
- 그래프 탭 전환: 모드별 주요 센서 데이터 확인
- 그래프에서 재생 위치 확인: 주황색 점선 참고
- **Ctrl+F5**: 브라우저 강력 새로고침 (캐시 무시)
